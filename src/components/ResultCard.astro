---
import '../styles/cards.css';
---
<script>
  let result = null;
  function renderResult() {
    try {
      const stored = localStorage.getItem('predictionResult');
      result = stored ? JSON.parse(stored) : null;
    } catch {
      result = null;
    }
    update();
  }
  function resetPrediction() {
    localStorage.removeItem('predictionResult');
    result = null;
    update();
  }
  function update() {
    const el = document.getElementById('result-card-root');
    if (el) {
      el.innerHTML = result ? window.renderResultCard(result) : '';
    }
  }
  window.renderResultCard = (result) => `
    <div class="card">
      <div class="flex items-center justify-center w-14 h-14 bg-blue-600 rounded-full mb-4">
        <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" d="M9 12l2 2l4-4" />
        </svg>
      </div>
      <h2 class="text-2xl font-bold text-gray-900 mb-2 text-center">Resultado de la Predicción</h2>
      <p class="text-gray-600 text-center mb-6">&nbsp;</p>
      <div class="w-full bg-blue-50 rounded-lg p-4 mb-4">
        <div class="text-xs text-blue-700 font-semibold mb-1">Cluster Asignado</div>
        <div class="text-2xl font-bold text-blue-800 mb-2">Cluster ${result.cluster}</div>
      </div>
      <div class="w-full mb-4">
        <div class="text-xs text-gray-500 font-semibold mb-1">Descripción</div>
        <div class="text-gray-700">${result.descripcion}</div>
      </div>
      <div class="w-full mb-4">
        <div class="text-xs text-blue-700 font-semibold mb-1">Características del Perfil</div>
        <ul class="text-gray-700 text-sm list-disc pl-5">
          ${result.edad ? `<li>Edad: ${result.edad} años</li>` : ''}
          ${result.genero !== undefined ? `<li>Género: ${result.genero === 1 ? 'Femenino' : 'Masculino'}</li>` : ''}
          ${result.monto_promedio !== undefined ? `<li>Monto promedio: $${Number(result.monto_promedio).toLocaleString(undefined, {minimumFractionDigits:2})}</li>` : ''}
          ${result.saldo_promedio !== undefined ? `<li>Saldo promedio: $${Number(result.saldo_promedio).toLocaleString(undefined, {minimumFractionDigits:2})}</li>` : ''}
        </ul>
      </div>
      <div class="w-full mb-6">
        <div class="text-xs text-blue-700 font-semibold mb-1">Nivel de Confianza</div>
        <div class="w-full bg-blue-100 rounded-full h-3">
          <div class="bg-blue-500 h-3 rounded-full transition-all" style="width: ${(result.confianza !== undefined ? result.confianza : 85)}%"></div>
        </div>
        <div class="text-right text-xs text-blue-700 font-semibold mt-1">${(result.confianza !== undefined ? Number(result.confianza).toFixed(1) : '85.0')}%</div>
      </div>
      <button class="w-full py-2 px-4 bg-gray-100 hover:bg-gray-200 text-blue-700 font-semibold rounded-lg shadow transition duration-200" onclick="window.resetPrediction()">Nueva Predicción</button>
    </div>
  `;
  window.resetPrediction = resetPrediction;
  window.addEventListener('updateResultCard', renderResult);
  window.addEventListener('DOMContentLoaded', renderResult);
</script>
<div id="result-card-root"></div>